name: php
version: '8.4'

summary: A popular general-purpose scripting language that is especially suited to web development.
description: |
    PHP is a general-purpose scripting language well-suited for Web
    development. Fast, flexible and pragmatic, PHP powers everything
    from your blog to the most popular websites in the world.

    This image is a chiselled Ubuntu rock that contains only the PHP interpreter
    and its core dependencies, no additional modules available.

base: bare
# TODO: Update to 25.04 when available
build-base: ubuntu@24.04

run-user: _daemon_

platforms:
    amd64:
    arm64:

parts:
    php:
        plugin: nil
        source: https://github.com/alesancor1/chisel-releases.git
        source-type: git
        source-branch: 25.04/php
        override-build: |
            chisel cut --release ./ --root ${CRAFT_PART_INSTALL} \
                base-files_base \
                base-files_release-info \
                base-files_chisel \
                php_core

    # TODO waiting for chisel-releases PR
    # php:
    #     plugin: nil
    #     stage-packages:
    #         - base-files_base
    #         - base-files_release-info
    #         - base-files_chisel
    #         - php_core

    deb-security-manifest:
        plugin: make
        source: https://github.com/canonical/rocks-security-manifest
        source-type: git
        source-branch: main
        override-prime: gen_manifest
